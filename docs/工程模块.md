## Milestone 0：仓库与脚手架

1. **初始化项目**

   * `tauri init` + React（Vite）前端
   * 引入 Fluent UI React（`@fluentui/react-components`）
2. **代码结构**

   * `src-ui/`（React 前端）
   * `src-tauri/`（Rust 核心）
   * `assets/`（内置映射 JSON、图标）
3. **基础 CI（可选）**

   * `cargo fmt` / `clippy`
   * `npm lint` / `npm test`

**交付物**

* 可运行空壳应用（托盘图标 + 一个窗口）

---

## Milestone 1：托盘与窗口行为（默认隐藏）

1. **托盘（System Tray）**

   * 托盘菜单：Quick Input / Settings / Quit
   * 默认启动后隐藏主窗口（只显示托盘）
2. **窗口类型与样式**

   * Quick Input Window：无边框、置顶、固定尺寸、弹出即聚焦
   * Manager Window：普通窗口（映射管理页）
3. **窗口显示/隐藏 API**

   * Rust command：`show_quick_input()`, `hide_quick_input()`, `toggle_quick_input()`
   * Rust command：`show_manager()`

**验收**

* 启动后不弹窗；托盘可打开管理页与快速输入框

---

## Milestone 2：全局快捷键（默认 Alt+S，可配置）

1. **全局快捷键监听**

   * 默认注册 `Alt+S`（Windows）
   * 触发：`toggle_quick_input`
2. **快捷键配置**

   * Settings 中可修改热键
   * 保存到 IndexedDB settings
   * 修改后：注销旧热键，注册新热键
3. **冲突检测**

   * 注册失败时 UI 提示并回退到旧快捷键

**验收**

* 任意前台应用下 `Alt+S` 弹出输入框，Esc 关闭

---

## Milestone 3：内置映射（只读）加载与搜索引擎

1. **内置映射资源**

   * `assets/builtin_mappings.json`
   * 结构建议：`[{ key: "sigma", value: "σ", aliases?:[], tags?:[], note?:"" }, ...]`
2. **加载策略**

   * 前端启动时加载（fetch static asset）或由 Rust 提供只读资源
   * 内存索引：`keyLower -> entries[]`
3. **搜索引擎实现**

   * 输入 query 实时过滤（debounce 0~50ms）
   * 匹配规则：

     * 精确匹配 > 前缀匹配 > 子串匹配
   * 排序可插槽：MRU 加权（后续）
4. **UI 候选列表**

   * 输入框 + 列表（上下键选择）
   * 回车选择当前项

**验收**

* 输入 `sigma` 能搜到 `σ`，输入 `sig` 也能候选出现

---

## Milestone 4：IndexedDB 数据层（用户映射 + 设置 + MRU）

1. **IndexedDB 封装**

   * 推荐用 `idb` 库（轻量）或自写封装
   * stores：

     * `user_mappings`
     * `settings`
     * `mru`
2. **数据访问层（DAL）**

   * `getUserMapping(key)`
   * `listUserMappings({search, limit, offset})`
   * `upsertUserMapping({key,value,note,tags})`
   * `deleteUserMapping(key)`
   * `getSettings() / saveSettings()`
   * `addMRU(item) / listMRU() / clearMRU()`
3. **合并策略**

   * 搜索结果合并 built-in + user-defined
   * 冲突 key 默认 user 优先（可设置）

**验收**

* 新增用户映射后，搜索立即生效；重启后仍存在

---

## Milestone 5：管理页面（Fluent UI）—— 用户映射 CRUD

1. **页面结构**

   * Navigation：Mappings / Built-in (read-only) / Settings / Import-Export
2. **用户映射列表**

   * 表格展示 key/value/note/updated_at
   * 搜索框过滤
3. **新增/编辑 Dialog**

   * 校验：key 非空、value 非空、key 不包含控制字符
   * 冲突提示：若与 built-in 同名，提示“将覆盖优先级”
4. **删除确认**
5. **只读内置映射页**

   * 仅浏览/搜索，不允许编辑删除

**验收**

* CRUD 完整；built-in 不可改；冲突提示正确

---

## Milestone 6：输出到光标处（核心）—— Windows 优先

> 这个里程碑建议拆成两条实现路径：**注入输入（主） + 剪贴板粘贴（兜底）**

### 6A. 主路径：模拟键盘输入（SendInput 等）

1. **Rust 侧实现**

   * 提供 command：`insert_text(text: String)`
   * Windows 下实现：

     * 优先：发送 Unicode 输入（使用 `SendInput` + `KEYEVENTF_UNICODE`）
2. **错误处理**

   * 若注入失败，返回 error 给前端
3. **前端调用**

   * Quick Input 回车后调用 `insert_text(selected.value)` 并自动隐藏窗口

### 6B. 兜底：剪贴板 + 粘贴

1. **Rust/前端剪贴板写入**

   * 保存原剪贴板（可选）
   * 写入目标字符
2. **触发粘贴**

   * Windows：模拟 `Ctrl+V`
3. **恢复剪贴板（可选）**
4. **失败兜底**

   * 若粘贴失败，至少复制到剪贴板并 toast 提示

**验收**

* 在 Word / VS Code / 浏览器输入框：回车可插入字符
* 若注入不可用：剪贴板方案可用

---

## Milestone 7：快速输入面板体验打磨

1. **窗口定位**

   * 默认屏幕居中或跟随鼠标附近（可配置）
2. **自动聚焦与输入法兼容**

   * 确保唤起后输入框立刻可输入
3. **快捷键交互**

   * `Esc` 关闭
   * `Enter` 输出并关闭
   * `Tab` 在输入框/列表间切换（可选）
4. **空结果行为**

   * 显示 “No results”
   * Enter 默认不输出（可设置为输出原文本）

---

## Milestone 8：设置页（快捷键、输出策略、优先级）

1. **快捷键设置**

   * 热键录制控件（监听用户按键组合）
   * 保存并重新注册全局快捷键
2. **输出方式**

   * inject / clipboard_paste
   * restore_clipboard on/off
3. **优先级**

   * prefer_user_mapping on/off
4. **MRU**

   * MRU on/off
   * MRU size

---

## Milestone 9：导入/导出（JSON）

1. **导出用户映射**

   * JSON 文件下载（含 version、timestamp）
2. **导入**

   * 校验 schema
   * 冲突策略：覆盖/跳过/合并（默认合并覆盖用户自身同 key）
3. **内置映射不可导入覆盖**

   * 若导入 key 与 built-in 冲突，按“用户映射覆盖优先”策略即可，不改 built-in

---

## Milestone 10：打包、发布与回归测试

1. **Windows 打包**

   * 图标、版本号、签名（可选）
2. **最小回归用例清单**

   * 热键唤起
   * 搜索与排序
   * 输出到 Word / VS Code / 浏览器
   * 管理页 CRUD
   * 设置保存与重启后保持
3. **日志**

   * Rust + 前端 log 分级（INFO/WARN/ERROR）
   * 可选：导出日志文件

---

## 建议的任务优先级（最小可用 MVP）

1. 托盘 + 快捷键 + 快速输入窗（M1+M2）
2. 内置映射加载 + 搜索 UI（M3）
3. 输出到光标处（M6）
4. IndexedDB 用户映射 + 管理页 CRUD（M4+M5）
5. 设置页与导入导出（M8+M9）